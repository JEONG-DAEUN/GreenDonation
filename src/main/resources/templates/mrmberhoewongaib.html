<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Index</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
</head>
<body>
<fieldset>
    <legend>필수입력사항</legend>
    <div>
        <label for="memberId">아이디:
            <!--            <input id="memberId" name="memberId" type="text" maxlength="15" title="입력">-->
            <input id="memberId" type="text" name="memberId" placeholder="아이디를 입력해주세요." required maxlength="15">
            <!--            <span class="point successIdChk"></span><br/>-->
            <span class="point">※ 영문자, 소문자 입력가능, 최대 15자 까지 입력</span>
            <p id="idng" style="color:red;"></p>
            <p id="idok" style="color:green;"></p>
            <!--            <span class="point successNameChk">아이디는 6자이상 입력해 주세요.</span>-->

        </label>
        <button class="btn btn-lg btn-primary btn-block" id="rgAdm1">중복확인</button>
        <div>
            <label for="memberPassword">패스워드:
                <input id="memberPassword" name="memberPassword" type="password"
                       required maxlength="8" autocomplete="off">
                <span class="point">* 비밀번호는 총 8자 까지 입력이 가능합니다.</span>
            </label>
        </div>
        <div>
            <label for="cmemberPassword">패스워드 확인:
                <input id="cmemberPassword" name="cmemberPassword" type="password"
                       placeholder="동일하게 입력해 주세요." required maxlength="8" autocomplete="off">
                <p id="ng" style="color:red;"></p>
                <p id="ok" style="color:green;"></p>
            </label>

        </div>

        <div>
            <label for="name1">이름:
                <input id="name1" name="name1" type="text">
            </label>
        </div>
        <div>
            <label for="email">email:
                <input id="email" name="email" type="text">
            </label>
        </div>
        <div>
            <tr class="mobileNo">
                <th><label for="memberPhoneNumber">휴대폰 번호</label></th>
                <td><p><input id="memberPhoneNumber" type="text" name="memberPhoneNumber" title="전화번호 입력" required/>
                    <span id="phoneChk" class="doubleChk">인증번호 보내기</span><br/>
                    <input id="phone2" type="text" name="phone2" title="인증번호 입력" disabled required/>
                    <span id="phoneChk2" class="doubleChk">본인인증</span>
                    <span class="point successPhoneChk">휴대폰 번호 입력후 인증번호 보내기를 해주십시오.</span>
                    <input type="hidden" id="phoneDoubleChk"/></p>
                    <p class="tip"> 최초 가입 시에만 사용하고 있습니다. 따로 저장되지 않습니다.(번호만 입력해주세요.) </p></td>
            </tr>
        </div>

        <div>
            <label for="postalCode">우편 번호:
                <input id="postalCode" name="postalCode" type="text">
            </label>
        </div>
        <div>
            <label for="address">회원 주소:
                <input id="address" name="address" type="text">
            </label>
        </div>

</fieldset>
<button class="btn btn-lg btn-primary btn-block" id="rgAdm">회원가입</button>

</body>


<script>


    var code2 = "";
    $("#phoneChk").click(function () {
        alert("인증번호 발송이 완료되었습니다.\n휴대폰에서 인증번호 확인을 해주십시오.");
        var phone = $("#memberPhoneNumber").val();
        $.ajax({
            type: "GET", url: "phoneCheck?phone=" + memberPhoneNumber, cache: false, success: function (data) {
                if (data == "error") {
                    alert("휴대폰 번호가 올바르지 않습니다.")
                    $(".successPhoneChk").text("유효한 번호를 입력해주세요.");
                    $(".successPhoneChk").css("color", "red");
                    $("#memberPhoneNumber").attr("autofocus", true);
                } else {
                    $("#phone2").attr("disabled", false);
                    $("#phoneChk2").css("display", "inline-block");
                    $(".successPhoneChk").text("인증번호를 입력한 뒤 본인인증을 눌러주십시오.");
                    $(".successPhoneChk").css("color", "green");
                    $("#memberPhoneNumber").attr("readonly", true);
                    code2 = data;
                }
            }
        });
    });


    //휴대폰 인증번호 대조
    $("#phoneChk2").click(function () {
        if ($("#phone2").val() == code2) {
            $(".successPhoneChk").text("인증번호가 일치합니다.");
            $(".successPhoneChk").css("color", "green");
            $("#phoneDoubleChk").val("true");
            $("#phone2").attr("disabled", true);
        } else {
            $(".successPhoneChk").text("인증번호가 일치하지 않습니다. 확인해주시기 바랍니다.");
            $(".successPhoneChk").css("color", "red");
            $("#phoneDoubleChk").val("false");
            $(this).attr("autofocus", true);
        }
    });


    // 아이디 중복 확인
    $('#rgAdm1').click(function () {
        const memberId = $('#memberId').val();
        const json = JSON.stringify({
            memberId,
        })
        console.log("????????" + json)

        $.ajax({
            url: '/api/signUp',
            type: 'POST',
            dataType: 'text',
            contentType: "application/json",
            data: json,
            success: function (data) {
                console.log("????????" + data)

                if (data == "ng") {
                    document.getElementById('idok').innerHTML = ""
                    document.getElementById('idng').innerHTML = "아이디를 입력해주세요."
                } else {
                    if (data == "no") {
                        document.getElementById('idok').innerHTML = ""
                        document.getElementById('idng').innerHTML = "이미 등록된 회원이 었습니다"
                        return;

                    } else if (data == "ok") {

                        document.getElementById('idng').innerHTML = ""
                        document.getElementById('idok').innerHTML = "사용가능한 아이디 입니다."
                        return;
                    }
                }
            },
        })

    })

    //비밀번호 확인
    $(function () {
        $('#cmemberPassword').blur(function () {
            if ($('#memberPassword').val() != $('#cmemberPassword').val()) {
                if ($('#cmemberPassword').val() != '') {
                    document.getElementById('ng').innerHTML = "동일한 비밀번호를 입력해 주세요"
                    // alert("비밀번호가 일치하지 않습니다.");
                    $('#cmemberPassword').val('');
                    $('#cmemberPassword').focus();
                }
            } else {
                document.getElementById('ng').innerHTML = ""
                document.getElementById('ok').innerHTML = "동일한 비밀번호 입니다"
            }
        })
    });

    //데이터 전송
    $('#rgAdm').on("click", function () {
        const memberId = $('#memberId').val();
        const memberPassword = $('#memberPassword').val();
        const name1 = $("#name1").val();

        const email = $("#email").val();
        const phonenumber = $("#phonenumber").val();
        const address = $("#address").val();
        const postalCode = $("#postalCode").val();
        var type = 0;

        if (memberId == "" || memberPassword == "") {
            alert("아이디와 비밀번호는 필수기재사항입니다.");
        } else {
            const json = JSON.stringify({
                memberId: memberId,
                memberPassword: memberPassword,
                name1: name1,
                type: type,
                email: email,
                phonenumber: phonenumber,
                address: address,
                postalCode: postalCode


            })

            $.ajax({
                url: '/api/signUp1',
                type: 'POST',
                dataType: 'text',
                contentType: "application/json; charset=utf-8",
                data: json,
                success: function (data) {
                    console.log(data)
                    window.location.href = '/Login';
                },
            })


        }
    });
</script>

</html>